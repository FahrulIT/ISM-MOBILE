@model ISM_MAINTENANCE.Models.DB.vw_preventivemaintenance_history

@{
    ViewBag.Title = "Edit";
    Layout = "~/Views/Shared/_Layout.cshtml";

    int i = 0;
    string block = "'" + Model.block + "'";
    string loom = "'" + Model.loom_no + "'";
    string mtcDate = "'" + Model.mtc_schedule.ToString("yyyy-MM-dd") + "'";
    var _machine_no = Model.block + "." + Model.loom_no;
}

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()

    <div class="card">
        <div class="card-header bg-primary">
            <div class="text-white fs-6 fw-bold"><i class="ti ti-home"></i>  Header</div>
        </div>

        <div class="card-body">

            @Html.ValidationSummary(true, "", new { @class = "text-danger" })

            <div class="mb-2 row">
                <label class="control-label col-md-2">Department</label>
                <div class="col-md-2">
                    @Html.EditorFor(model => model.dept_name, new { htmlAttributes = new { @class = "form-control", @Value = "WEAVING", @ReadOnly = true, @Style = "background-color:lightgray;" } })
                    @Html.ValidationMessageFor(model => model.dept_name, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="mb-2 row">
                <label class="control-label col-md-2">Machine Type</label>
                <div class="col-md-2">
                    @Html.EditorFor(model => model.mc_name, new { htmlAttributes = new { @class = "form-control", @Value = "AJL", @ReadOnly = true, @Style = "background-color:lightgray;" } })
                    @Html.ValidationMessageFor(model => model.mc_name, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="mb-2 row">
                <label class="control-label col-md-2">MTC Schedule</label>
                <div class="col-md-2">
                    @Html.EditorFor(model => model.mtc_schedule, new { htmlAttributes = new { @class = "form-control", @Value = Model.mtc_schedule.ToString("MM-yyyy"), @Disabled = true, @Style = "background-color:lightgray;", @Autocomplete = "off" } })
                    @*@Html.EditorFor(model => model.mtc_schedule, new { htmlAttributes = new { @class = "form-control", @Value = Model.mtc_schedule.ToString("yyyy-MM"), @ReadOnly = true } })*@
                    @*<input class="form-control" id="scheduleDate" name="scheduleDate" autocomplete="off" value="@Model.mtc_schedule.ToString("MM-yyyy")" style="background-color:lightgray;" disabled/>*@

                    @*<input type="text" id="mtc_schedule" name="mtc_schedule" class="form-control" value="@Model.mtc_schedule.ToString("yyyy-MM")" style="background-color:lightgray;" />*@

                    @Html.ValidationMessageFor(model => model.mtc_schedule, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="mb-2 row">
                <label class="control-label col-md-2">Machine No.</label>
                <div class="col-md-2">
                    @*@Html.DropDownListFor(model => model.mtcNo, new SelectList(ViewBag.machineNo, "Value", "Text"), "-- PLEASE SELECT --", new { @class = "form-control chosen-select", @Disabled = true })*@
                    @Html.DropDownListFor(model => model.mtcNo, new SelectList(ViewBag.machineNo, "Value", "Text", _machine_no), "-- PLEASE SELECT --", new { @class = "form-control", @Disabled = true })
                    @*@Html.EditorFor(model => model.mtcNo, new { htmlAttributes = new { @class = "form-control gray-color-byfahrul", @ReadOnly = true } })*@
                    @Html.ValidationMessageFor(model => model.mtcNo, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="mb-2 row">
                <label class="control-label col-md-2">PIC Maintenance</label>
                <div class="col-md-3">
                    @*@Html.DropDownListFor(model => model.Fullname, new SelectList(ViewBag.userName, "Value", "Text"), "-- PLEASE SELECT --", new { @class = "form-control chosen-select" })*@
                    @*@Html.DropDownListFor(model => model.Fullname, new SelectList(ViewBag.userName, "Value", "Text"), "-- PLEASE SELECT --", new { @class = "form-control", @Disabled = true })*@

                    @Html.EditorFor(model => model.Fullname, new { htmlAttributes = new { @class = "form-control", @Value = Model.Fullname, @Readonly = true, @Style = "background-color:lightgray;" } })
                    @Html.ValidationMessageFor(model => model.Fullname, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="mb-2 row">
                <label class="control-label col-md-2">Start Maintenance</label>
                <div class="col-md-3">
                    @*@Html.EditorFor(model => model.mtc_start, new { htmlAttributes = new { @class = "form-control", @type = "datetime-local", @Value = Model.mtc_start.ToString("yyyy-MM-ddTHH:mm") } })*@

                    <input class="form-control" id="mtcStart" name="mtcStart" autocomplete="off" value="@Model.mtc_start.ToString("dd-MM-yyyy HH:mm")" />
                    @*@Html.EditorFor(model => model.mtc_start, new { htmlAttributes = new { @class = "form-control", @Value = Model.mtc_start.ToString("dd-MM-yyyy HH:mm"), @Autocomplete = "off" } })*@
                    @Html.ValidationMessageFor(model => model.mtc_start, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="mb-2 row">
                <label class="control-label col-md-2">Finish Maintenance</label>
                <div class="col-md-3">
                    @*@Html.EditorFor(model => model.mtc_finish, new { htmlAttributes = new { @class = "form-control", @type = "datetime-local", Value = Model.mtc_finish.ToString("yyyy-MM-ddTHH:mm") } })*@

                    <input class="form-control" id="mtcFinish" name="mtcFinish" autocomplete="off" value="@Model.mtc_finish.Value.ToString("dd-MM-yyyy HH:mm")" />
                    @*@Html.EditorFor(model => model.mtc_finish, new { htmlAttributes = new { @class = "form-control", @Value = Model.mtc_finish.ToString("dd-MM-yyyy HH:mm"), @Autocomplete = "off" } })*@
                    @Html.ValidationMessageFor(model => model.mtc_finish, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="mb-2 row">
                <label class="control-label col-md-2">Maintenance Action</label>
                <div class="col-md-7">
                    @*@Html.DropDownListFor(model => model.mtc_action_name, new SelectList(ViewBag.mtcAction, "Value", "Text"), "-- PLEASE SELECT --", new { @class = "form-control chosen-select" })*@
                    @Html.DropDownListFor(model => model.mtc_action_name, new SelectList(ViewBag.mtcAction, "Value", "Text"), "-- PLEASE SELECT --", new { @class = "form-control" })
                    @Html.ValidationMessageFor(model => model.mtc_action_name, "", new { @class = "text-danger" })
                </div>
            </div>

            @Html.HiddenFor(model => model.mtcNo)

            @Html.HiddenFor(model => model.mtc_schedule)

            @Html.HiddenFor(model => model.block)

            @Html.HiddenFor(model => model.loom_no)

            @Html.HiddenFor(model => model.mtc_start)

            @Html.HiddenFor(model => model.dept_id)

            @Html.HiddenFor(model => model.mc_id)

            @Html.HiddenFor(model => model.mtc_id)

            @Html.HiddenFor(model => model.mtc_action_id)

            @Html.HiddenFor(model => model.pic_mtc)

            @Html.HiddenFor(model => model.proc_no)

        </div>
        <div class="card-footer"></div>
    </div>
    <div class="card">
        <div class="card-header bg-primary">
            <div class="float-start bg-primary">
                <div class="text-white fs-6 fw-bold"><i class="ti ti-tool"></i> Spare Parts</div>
            </div>
            <div class="float-end">
                <button type="button" class="btn btn-outline-light-primary" id="OpenModal_SparePart" data-bs-toggle="modal" data-bs-target="#SparepartModal">
                    <i class="ti ti-square-plus"></i>   Add Detail
                </button>
            </div>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table id="SparepareDetailTable" class="display table search-table table-sm  align-middle text-nowrap" style="color:black;" >
                    <thead class="header-item">
                        <tr>
                            <th>
                                No
                            </th>
                            <th>
                                Spare Part
                            </th>
                            <th>
                                Unit Price (USD)
                            </th>
                            <th>
                                Quantity
                            </th>
                            <th>
                                Action
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in ViewBag.prevSpareParts)
                        {
                            <tr>
                                <td style="text-align:center;">
                                    @(i = i + 1)
                                </td>
                                <td style="width:60%;">
                                    @item.ItemName<input type="hidden" name="Detail_2[@i].item_name" value="@item.item_code" class="form-control" />
                                </td>
                                <td>
                                    <input type="text" name="Detail_2[@i].price" value="@item.price" class="form-control text-center" />
                                </td>
                                <td>
                                    <input type="text" name="Detail_2[@i].quantity" value="@item.quantity" class="form-control text-center" />
                                </td>
                                <td>                                  
                                    <i class="btn btn-danger" title="Delete" style="font-style:normal;"
                                       onclick="myFunction(this, @Model.dept_id, @Model.mc_id, @mtcDate, @block, @loom)">Delete</i>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="card-footer"></div>
    <div class="mb-1 row">
        <div class="col-md-5">
            <button type="submit" class="btn btn-primary" onclick="return checkMonth()"><i class="ti ti-edit"></i>  Save</button>
            <a class="btn btn-primary" href="@Url.Action("Index","MaintenancePreventiveHistory")"><i class="ti ti-arrow-back"></i>  Back</a>
        </div>
    </div>
}

<!-- Sparepart Modal -->
<div class="modal fade" id="SparepartModal" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <form id="details3ModalForm">
                <div class="modal-header text-center" style="border-bottom:2px solid; border-bottom-color: rgba(165, 173, 179, 0.3);">
                    <h4 class="modal-title text-black fw-bold" id="exampleModalLabel">Add Detail</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-12 row">
                        <label class="control-label col-md-2">Spare Part</label>
                        <div class="col-md-8">
                            @Html.DropDownList("spareParts", new SelectList(ViewBag.spareParts, "Value", "Text"), "-- PLEASE SELECT --", new { @class = "form-control" })
                            <input type="hidden" name="itemCode" id="itemCode" class="form-control" />
                        </div>
                    </div>
                    <br />
                    <div class="mb-12 row">
                        <label class="control-label col-md-2">Unit Price (USD)</label>
                        <div class="col-md-5">
                            @Html.Editor("unitPrice", new { htmlAttributes = new { @class = "form-control", @style = "text-align:right;" } })
                            @Html.ValidationMessage("unitPrice", "", new { @class = "text-danger" })
                        </div>
                    </div>
                    <br />
                    <div class="mb-12 row">
                        <label class="control-label col-md-2">Quantity</label>
                        <div class="col-md-5">
                            @Html.Editor("quantity", new { htmlAttributes = new { @class = "form-control", @style = "text-align:right;" } })
                            @Html.ValidationMessage("quantity", "", new { @class = "text-danger" })
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="GetSparepart"><span class="fa fa-save"></span> Save</button>
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="Back"><span class="fa fa-eject"></span> Back</button>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- Sparepart Modal -->

<script src="~/Content/libs/jquery/dist/jquery.min.js"></script>
<script src="~/Content/libs/jquery/dist/jquery.js"></script>

<link href="~/Content/css/select2.min.css" rel="stylesheet" />
<script src="~/Content/js/select2.min.js"></script>

@*<link href="~/Content/PreventiveMaintenance/datepicker/css/datepicker.css" rel="stylesheet" />
    <script src="~/Content/PreventiveMaintenance/datepicker/js/bootstrap-datepicker.js"></script>*@

<link href="~/Content/css/jquery.datetimepicker.css" rel="stylesheet" />
<script src="~/Content/js/jquery.datetimepicker.full.js"></script>

<script src="~/Content/PreventiveMaintenance/site.js"></script>

<script type="text/javascript">

    $('#mtcStart').datetimepicker({
        format: 'd-m-Y H:i',
        timepicker: true,
        datepicker: true
    });

    $('#mtcFinish').datetimepicker({
        format: 'd-m-Y H:i',
        timepicker: true,
        datepicker: true
    });

</script>